name: CI

on:
  workflow_dispatch:

jobs:
  build-python:
    runs-on: windows-latest

    steps:
      - name: Checkout (just to have a workspace)
        uses: actions/checkout@v4

      - name: Download CPython 3.12.12 source
        run: |
          curl -L -o Python-3.12.12.tgz https://www.python.org/ftp/python/3.12.12/Python-3.12.12.tgz

      - name: Extract source
        run: |
          tar -xvf Python-3.12.12.tgz
        shell: bash

      - name: List extracted content
        run: |
          dir
          dir Python-3.12.12

      - name: Prepare external deps
        run: |
          cd Python-3.12.12\PCbuild
          call get_externals.bat
        shell: cmd

      - name: Build CPython (Release x64)
        run: |
          cd Python-3.12.12\PCbuild
          call build.bat -c Release -p x64
        shell: cmd

      - name: Collect build outputs
        run: |
          mkdir output
          copy Python-3.12.12\PCbuild\amd64\* output\
        shell: cmd

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: cpython-3.12.12-win64
          path: output\
